webpackJsonp([2],{"2sPy":function(e,t){},AlLZ:function(e,t){},YOyO:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s("Dd8w"),a=s.n(r),n=s("s0MJ"),i={props:{placeholder:{type:String,default:"搜索歌曲、歌手"}},data:function(){return{query:""}},methods:{clear:function(){this.query=""},setQuery:function(e){this.query=e},blur:function(){this.$refs.query.blur()}},created:function(){var e=this;this.$watch("query",function(t){Object(n.a)(e.$emit("query",t),220)})}},o={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"search-box"},[s("i",{staticClass:"fa fa-search"}),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.query,expression:"query"}],ref:"query",staticClass:"box",attrs:{placeholder:e.placeholder},domProps:{value:e.query},on:{input:function(t){t.target.composing||(e.query=t.target.value)}}}),e._v(" "),s("i",{directives:[{name:"show",rawName:"v-show",value:e.query,expression:"query"}],staticClass:"fa fa-times",on:{click:e.clear}})])},staticRenderFns:[]};var c=s("VU/8")(i,o,!1,function(e){s("wU9T")},"data-v-47af5c3a",null).exports,l=s("I29D"),u=s.n(l),h=s("bLRB"),f=s("GAzl"),d=s("VNRf"),v=s("48sp"),p=s("8LE5"),m={data:function(){return{page:0,songs:[],pullup:!0,hasMore:!0,prompt:!1,beforeScroll:!0}},components:{Scroll:f.a,Loading:d.a,Prompt:p.a},props:{query:{type:String,default:""},showSinger:{type:Boolean,default:!0}},watch:{query:function(e){if(""===e)return this.songs=[],this.hasMore=!1,void(this.page=0);this.songs=[],this.page=0,this.hasMore=!0,this.search()}},methods:a()({search:function(){var e=this;this.hasMore=!0,this.$refs.suggest.scrollTo(0,0),u.a.get("/search",{params:{keywords:this.query,offset:this.page}}).then(function(t){if(200===t.status){var s=[];t.data.result.songs.forEach(function(e){s.push(Object(h.d)(e))}),e.songs=s}}),this.page+=30},searchMore:function(){var e=this;this.hasMore&&u.a.get("/search",{params:{keywords:this.query,offset:this.page}}).then(function(t){var s=t.data.result.songs;if(t.data.result.songs){var r=[];s.forEach(function(e){r.push(Object(h.d)(e))}),e.songs=e.songs.concat(r),e.page+=30}else e.hasMore=!1})}},Object(v.b)(["insertSong"]),Object(v.d)({setCurrentUrl:"SET_CURRENT_URL"}),{selectItem:function(e){var t=this;u.a.get("/song/url",{params:{id:e.id}}).then(function(s){var r=s.data.data[0].url;if(null===r)return t.prompt=!0,void t.OutPrompt();t.getSongImage(e.id).then(function(s){e.image=s.data.songs[0].al.picUrl,t.insertSong(e),console.log(e)}),t.setCurrentUrl(r)}),this.$emit("select")},getSongImage:function(e){return u.a.get("/song/detail",{params:{ids:e}})},OutPrompt:function(){var e=this,t=setTimeout(function(){e.prompt=!1,clearTimeout(t)},1800)},listScroll:function(){this.$emit("listScroll")}})},g={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("scroll",{ref:"suggest",staticClass:"suggest",attrs:{data:e.songs,pullup:e.pullup,beforeScroll:e.beforeScroll},on:{beforeScroll:e.listScroll,scrollToEnd:e.searchMore}},[s("ul",{staticClass:"suggest-list"},e._l(e.songs,function(t,r){return s("li",{key:r,staticClass:"suggest-item",on:{click:function(s){return e.selectItem(t)}}},[s("div",{staticClass:"name"},[s("p",{staticClass:"text"},[e._v(e._s(t.name)+" — "+e._s(t.singer))])])])}),0),e._v(" "),s("loading",{directives:[{name:"show",rawName:"v-show",value:e.hasMore,expression:"hasMore"}]}),e._v(" "),s("transition",{attrs:{"enter-active-class":"bounceInLeft","leave-active-class":"fadeOutUp",duration:{enter:500,leave:800}}},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.prompt,expression:"prompt"}],staticClass:"prompt-container animated"},[s("prompt")],1)]),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:!e.hasMore&&!e.songs.length,expression:"!hasMore && !songs.length"}],staticClass:"no-result-wrapper"},[e._v("\n    抱歉，未搜索出结果\n  ")])],1)},staticRenderFns:[]};var y=s("VU/8")(m,g,!1,function(e){s("AlLZ")},"data-v-5645232c",null).exports,w={props:{searches:{type:Array,default:function(){return[]}}},methods:{selectItem:function(e){this.$emit("select",e)},deleteOne:function(e){this.$emit("delete",e)}}},_={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"show",rawName:"v-show",value:e.searches.length,expression:"searches.length"}],staticClass:"search-list"},[s("ul",e._l(e.searches,function(t,r){return s("li",{key:r,staticClass:"search-item",on:{click:function(s){return e.selectItem(t)}}},[s("span",{staticClass:"text"},[e._v(e._s(t))]),e._v(" "),s("span",{staticClass:"icon",on:{click:function(s){return s.stopPropagation(),e.deleteOne(t)}}},[s("i",{staticClass:"fa fa-times"})])])}),0)])},staticRenderFns:[]};var C={data:function(){return{hots:[],query:""}},created:function(){this._getHotKey()},components:{SearchBox:c,Suggest:y,SearchList:s("VU/8")(w,_,!1,function(e){s("2sPy")},"data-v-448bdfa0",null).exports,Confirm:s("ntUn").a,Scroll:f.a},computed:a()({},Object(v.c)(["searchHistory"]),{shortcut:function(){return this.hots.concat(this.searchHistory)}}),watch:{query:function(e){var t=this;e||setTimeout(function(){t.$refs.shortcut.refresh()},20)}},methods:a()({},Object(v.b)(["saveSearchHistory","deleteSearchHistory","clearSearchHistory"]),{_getHotKey:function(){var e=this;u.a.get("/search/hot").then(function(t){200===t.status&&(e.hots=t.data.result.hots)})},addQuery:function(e){this.$refs.searchBox.setQuery(e)},deleteOne:function(e){this.deleteSearchHistory(e)},deleteAll:function(){this.clearSearchHistory()},onQueryChange:function(e){this.query=e},blurInput:function(){this.$refs.searchBox.blur()},saveSearch:function(){this.saveSearchHistory(this.query)},showConfirm:function(){this.$refs.confirm.show()}})},q={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"search"},[s("div",{staticClass:"search-box-wrapper"},[s("search-box",{ref:"searchBox",on:{query:e.onQueryChange}})],1),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:!e.query,expression:"!query"}],staticClass:"shortcut-wrapper"},[s("scroll",{ref:"shortcut",staticClass:"shortcut",attrs:{data:e.shortcut}},[s("div",[s("div",{staticClass:"hot-key"},[s("h1",{staticClass:"title"},[e._v("热门搜索")]),e._v(" "),s("ul",e._l(e.hots,function(t,r){return s("li",{key:r,staticClass:"item",on:{click:function(s){return e.addQuery(t.first)}}},[s("span",[e._v(e._s(t.first))])])}),0)]),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.searchHistory.length,expression:"searchHistory.length"}],staticClass:"search-history"},[s("h1",{staticClass:"title"},[s("span",{staticClass:"text"},[e._v("搜索历史")]),e._v(" "),s("span",{staticClass:"clear",on:{click:e.showConfirm}},[s("i",{staticClass:"fa fa-trash"})])]),e._v(" "),s("search-list",{attrs:{searches:e.searchHistory},on:{select:e.addQuery,delete:e.deleteOne}})],1)])])],1),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.query,expression:"query"}],staticClass:"search-result"},[s("suggest",{attrs:{query:e.query},on:{listScroll:e.blurInput,select:e.saveSearch}})],1),e._v(" "),s("confirm",{ref:"confirm",attrs:{text:"是否清空搜索历史数据",confirBtnText:"清空"},on:{confirm:e.deleteAll}}),e._v(" "),s("router-view")],1)},staticRenderFns:[]};var S=s("VU/8")(C,q,!1,function(e){s("yEvq")},"data-v-b5e79822",null);t.default=S.exports},wU9T:function(e,t){},yEvq:function(e,t){}});
//# sourceMappingURL=2.1525393b20c5e19dc6da.js.map